<!DOCTYPE html>
<html lang="en">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>Power Move | Enterprise AI Scouting</title>
    <script src="https://unpkg.com/react@18/umd/react.development.js"></script>
    <script src="https://unpkg.com/react-dom@18/umd/react-dom.development.js"></script>
    <script src="https://unpkg.com/@babel/standalone/babel.min.js"></script>
    <script src="https://cdn.tailwindcss.com"></script>
    <link href="https://fonts.googleapis.com/css2?family=Inter:wght@400;600;700&family=JetBrains+Mono&display=swap" rel="stylesheet">
    <style>
        body { font-family: 'Inter', sans-serif; background-color: #0f172a; color: #f8fafc; }
        .mono { font-family: 'JetBrains Mono', monospace; }
        .glass { background: rgba(30, 41, 59, 0.7); backdrop-filter: blur(12px); border: 1px solid rgba(255,255,255,0.1); }
        .agent-gradient { background: linear-gradient(135deg, #3b82f6 0%, #2563eb 100%); }
    </style>
</head>
<body>
    <div id="root"></div>

    <script type="text/babel">
        const { useState, useEffect, useRef } = React;

        const SidebarItem = ({ icon, label, active, onClick }) => (
            <div 
                onClick={onClick}
                className={`flex items-center gap-3 p-3 rounded-lg cursor-pointer transition-all ${active ? 'bg-blue-600 text-white shadow-lg' : 'hover:bg-slate-800 text-slate-400'}`}
            >
                <span className="text-xl">{icon}</span>
                <span className="font-semibold text-sm uppercase tracking-wider">{label}</span>
            </div>
        );

        const StatCard = ({ label, value, sub }) => (
            <div className="glass p-4 rounded-xl">
                <div className="text-xs text-slate-400 uppercase font-bold mb-1">{label}</div>
                <div className="text-2xl font-bold text-blue-400">{value}</div>
                {sub && <div className="text-[10px] text-slate-500 mt-1">{sub}</div>}
            </div>
        );

        const App = () => {
            const [view, setView] = useState('war-room');
            const [query, setQuery] = useState('');
            const [loading, setLoading] = useState(false);
            const [player, setPlayer] = useState(null);
            const [chat, setChat] = useState([
                { role: 'assistant', content: "Welcome to the War Room. I'm your AI Scout. Who are we evaluating today?" }
            ]);

            const API_BASE = "http://localhost:8000/api/v1";

            const runAnalysis = async (playerData) => {
                setChat(prev => [...prev, { role: 'assistant', content: "Initializing deep-dive analysis... fetching Statcast data..." }]);
                try {
                    const res = await fetch(`${API_BASE}/agent/analyze`, {
                        method: 'POST',
                        headers: { 'Content-Type': 'application/json' },
                        body: JSON.stringify({
                            player_name: playerData.fullName,
                            stats: playerData.allStats?.[0] || {}
                        })
                    });
                    const data = await res.json();
                    setChat(prev => [...prev, { role: 'assistant', content: data.report }]);
                } catch (err) {
                    setChat(prev => [...prev, { role: 'assistant', content: "Analysis failed. System offline or local API unreachable. Proceeding with heuristic fallback..." }]);
                }
            };

            const searchPlayer = async (e) => {
                e.preventDefault();
                setLoading(true);
                setChat(prev => [...prev, { role: 'user', content: `Search for ${query}` }]);
                
                try {
                    const res = await fetch(`${API_BASE}/players/search?name=${encodeURIComponent(query)}`);
                    const data = await res.json();
                    
                    if (data.people && data.people.length > 0) {
                        const p = data.people[0];
                        // Get stats
                        const statsRes = await fetch(`${API_BASE}/players/${p.id}/stats`);
                        const statsData = await statsRes.json();
                        const person = statsData.people[0];
                        
                        const playerData = { ...person, allStats: person.stats || [] };
                        setPlayer(playerData);
                        setChat(prev => [...prev, { role: 'assistant', content: `Found ${p.fullName}. Lineup card updated. Should I run a full scouting report?` }]);
                        // Automatically run analysis for demo purposes
                        runAnalysis(playerData);
                    } else {
                        setChat(prev => [...prev, { role: 'assistant', content: "No records found in the central database." }]);
                    }
                } catch (err) {
                    setChat(prev => [...prev, { role: 'assistant', content: "Connection to MLB Central failed. Check your local API server." }]);
                } finally {
                    setLoading(false);
                }
            };

            return (
                <div className="flex h-screen overflow-hidden">
                    {/* Sidebar */}
                    <div className="w-64 glass border-r border-slate-800 flex flex-col p-4">
                        <div className="flex items-center gap-2 px-2 mb-10">
                            <div className="w-8 h-8 agent-gradient rounded-lg flex items-center justify-center font-bold">P</div>
                            <h1 className="text-xl font-bold tracking-tighter uppercase">Power Move</h1>
                        </div>
                        
                        <div className="flex-1 space-y-2">
                            <SidebarItem icon="‚öîÔ∏è" label="War Room" active={view === 'war-room'} onClick={() => setView('war-room')} />
                            <SidebarItem icon="üìä" label="Analytics" active={view === 'analytics'} onClick={() => setView('analytics')} />
                            <SidebarItem icon="üìú" label="Rulebook" active={view === 'rulebook'} onClick={() => setView('rulebook')} />
                        </div>

                        <div className="p-4 glass rounded-xl text-[10px] text-slate-500 uppercase font-bold tracking-widest">
                            AI Engine: Gemini Pro 1.5
                        </div>
                    </div>

                    {/* Main Content */}
                    <main className="flex-1 flex flex-col relative overflow-hidden bg-[#020617]">
                        {/* Header */}
                        <header className="h-16 glass border-b border-slate-800 flex items-center justify-between px-8 z-10">
                            <div className="flex items-center gap-4">
                                <form onSubmit={searchPlayer} className="relative">
                                    <input 
                                        type="text" 
                                        value={query}
                                        onChange={(e) => setQuery(e.target.value)}
                                        placeholder="SEARCH PLAYER..." 
                                        className="bg-slate-900 border border-slate-700 rounded-full px-10 py-1 text-sm focus:outline-none focus:ring-2 focus:ring-blue-500 w-64 mono uppercase"
                                    />
                                    <span className="absolute left-4 top-1.5 opacity-40">üîç</span>
                                </form>
                            </div>
                            <div className="flex items-center gap-4 text-xs font-bold uppercase tracking-widest text-slate-400">
                                <span>Status: <span className="text-green-500">Live Data</span></span>
                                <div className="w-8 h-8 rounded-full bg-slate-800 border border-slate-700"></div>
                            </div>
                        </header>

                        <div className="flex-1 flex overflow-hidden p-6 gap-6">
                            {/* Dashboard Left: Chat & Intel */}
                            <div className="flex-1 flex flex-col gap-6">
                                <div className="flex-1 glass rounded-2xl flex flex-col overflow-hidden">
                                    <div className="bg-slate-800/50 p-3 px-6 text-xs font-bold uppercase tracking-widest border-b border-white/5 flex justify-between items-center">
                                        <span>Agent Communications</span>
                                        <div className="flex gap-1">
                                            <div className="w-2 h-2 rounded-full bg-red-500 animate-pulse"></div>
                                            <div className="w-2 h-2 rounded-full bg-yellow-500 animate-pulse"></div>
                                            <div className="w-2 h-2 rounded-full bg-green-500 animate-pulse"></div>
                                        </div>
                                    </div>
                                    <div className="flex-1 overflow-y-auto p-6 space-y-4 mono text-sm">
                                        {chat.map((msg, i) => (
                                            <div key={i} className={`flex ${msg.role === 'user' ? 'justify-end' : 'justify-start'}`}>
                                                <div className={`max-w-[80%] p-3 rounded-lg ${msg.role === 'user' ? 'bg-blue-600/20 border border-blue-500/30' : 'bg-slate-800/80 border border-slate-700'}`}>
                                                    <div className="text-[10px] opacity-40 mb-1 uppercase font-bold">{msg.role}</div>
                                                    <div className="whitespace-pre-wrap">{msg.content}</div>
                                                </div>
                                            </div>
                                        ))}
                                        {loading && <div className="animate-pulse text-blue-500">SCANNINING DATABASE...</div>}
                                    </div>
                                </div>
                            </div>

                            {/* Dashboard Right: Player Detail */}
                            <div className="w-96 flex flex-col gap-6">
                                {player ? (
                                    <div className="glass rounded-2xl overflow-hidden animate-in fade-in slide-in-from-right-4 duration-500">
                                        <div className="relative h-48 bg-slate-800">
                                            <img 
                                                src={`https://img.mlbstatic.com/mlb-photos/pitcher/vertices/120/${player.id}.jpg`}
                                                className="w-full h-full object-cover opacity-50 grayscale hover:grayscale-0 transition-all cursor-crosshair"
                                                alt={player.fullName}
                                            />
                                            <div className="absolute bottom-0 left-0 w-full p-6 bg-gradient-to-t from-slate-950 to-transparent">
                                                <div className="text-3xl font-black uppercase italic tracking-tighter">{player.fullName}</div>
                                                <div className="text-sm font-bold text-blue-400 uppercase tracking-widest">#{player.primaryNumber} | {player.primaryPosition?.name}</div>
                                            </div>
                                        </div>
                                        
                                        <div className="p-6 space-y-6">
                                            <div className="grid grid-cols-2 gap-4">
                                                {player.allStats?.[0]?.group === 'hitting' ? (
                                                    <>
                                                        <StatCard label="AVG" value={player.allStats[0].splits[0].stat.avg} />
                                                        <StatCard label="HR" value={player.allStats[0].splits[0].stat.homeRuns} />
                                                        <StatCard label="RBI" value={player.allStats[0].splits[0].stat.rbi} />
                                                        <StatCard label="OPS" value={player.allStats[0].splits[0].stat.ops} />
                                                    </>
                                                ) : (
                                                    <>
                                                        <StatCard label="W-L" value={`${player.allStats[0]?.splits[0]?.stat?.wins}-${player.allStats[0]?.splits[0]?.stat?.losses}`} />
                                                        <StatCard label="ERA" value={player.allStats[0]?.splits[0]?.stat?.era} />
                                                        <StatCard label="SO" value={player.allStats[0]?.splits[0]?.stat?.strikeOuts} />
                                                        <StatCard label="WHIP" value={player.allStats[0]?.splits[0]?.stat?.whip} />
                                                    </>
                                                )}
                                            </div>

                                            <div className="space-y-2">
                                                <div className="text-[10px] text-slate-500 uppercase font-bold">Biometrics</div>
                                                <div className="flex justify-between text-xs border-b border-white/5 pb-2">
                                                    <span>Height</span>
                                                    <span className="font-bold">{player.height}</span>
                                                </div>
                                                <div className="flex justify-between text-xs border-b border-white/5 pb-2">
                                                    <span>Weight</span>
                                                    <span className="font-bold">{player.weight} lbs</span>
                                                </div>
                                                <div className="flex justify-between text-xs">
                                                    <span>Age</span>
                                                    <span className="font-bold">{player.currentAge}</span>
                                                </div>
                                            </div>
                                        </div>
                                    </div>
                                ) : (
                                    <div className="flex-1 glass rounded-2xl flex flex-col items-center justify-center opacity-30 border-dashed">
                                        <div className="text-4xl mb-4">‚öæ</div>
                                        <div className="text-xs font-bold uppercase tracking-[0.3em]">No Target Selected</div>
                                    </div>
                                )}
                                
                                <div className="glass rounded-2xl p-4">
                                    <div className="text-[10px] text-slate-500 uppercase font-bold mb-3 tracking-widest">System Load</div>
                                    <div className="h-1.5 bg-slate-800 rounded-full overflow-hidden">
                                        <div className="h-full bg-blue-500 w-[65%] shadow-[0_0_10px_#3b82f6]"></div>
                                    </div>
                                </div>
                            </div>
                        </div>
                    </main>
                </div>
            );
        };

        const root = ReactDOM.createRoot(document.getElementById('root'));
        root.render(<App />);
    </script>
</body>
</html>
